<!DOCTYPE html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/x-icon" href="img/index/옷빌리지빨강 수정.png">
    <link rel="stylesheet" href="css/color.css">
    <link rel="stylesheet" href="css/font.css">
    <link rel="stylesheet" href="css/wearVillageBtn.css">
    <script type="text/javascript" src="https://static.nid.naver.com/js/naveridlogin_js_sdk_2.0.2.js"
        charset="utf-8"></script>
    <script type="text/javascript" src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
</head>
<body>
    <div th:fragment="memberjoin">
        <link layout:fragment="css" rel="stylesheet" href="css/memberjoin.css">
        <div class="memberjoin_display_top">
        <div class="memberjoin_container">
            <div class="memberjoin_main">
                <div class="full" action="/" method="post">
                    <!-- 0번째 화면 -->
                    <div class="memberjoin_display memberjoin_dp0">
                        <div class="memberjoin_dp_main">
                            <div class="memberjoin_logo">
                                <img class="memberjoin_logo_img" src="img/img_wearVillageLogo.png" alt="">
                                <p class="footer_title">WearVillage</p>
                            </div>
                            <div class="memberjoin_top">
                                <h3>계정 만들기</h3>
                                아이디를 입력하세요.
                            </div>
                        </div>
                        <div class="memberjoin_dp_main">
                            <br>
                            <br>
                            <br>
                            <br>
                            <div class="memberjoin_input">
                                <input type="text" class="memberjoin_bar" id="id_box" placeholder="" 
                                onblur="id_check();javascript:duplicate_check=false;" name="userId">
                                <label class="memberjoin_ex" for="id_box">아이디</label>
                            </div>
                        </div>
                        <p id="id_text" class="memberjoinError" style="color: rgba(100, 100, 100, 0.6);">영문, 숫자를 조합한 6~20자</p>
                       
                        <div class="memberjoin_next_btn memberjoin_btn0 ">
                        <p class="memberjoin_error" id="memberjoin_nextbtn_error0"></p>
                            <button class="memberjoin_btn wearVillageBtn" 
                            id="nextbtn0">다음</button>
                        </div>
                    </div>
                    <!-- 1번째 화면 -->
                    <div class="memberjoin_display memberjoin_dp1">
                        <div class="memberjoin_dp_main">
                            <div class="memberjoin_logo">
                                <img class="memberjoin_logo_img" src="img/img_wearVillageLogo.png" alt="">
                                <p class="footer_title">WearVillage</p>
                            </div>
                            <div class="memberjoin_top">
                                <h3>계정 만들기</h3>
                                비밀번호를 입력하세요.
                            </div>
                        </div>
                        <div class="memberjoin_dp_main">
                            <div class="memberjoin_input">
                                <input type="password" class="memberjoin_bar" id="pw_box" placeholder='' 
                                onblur="pw_check(), pw_check1()" name="userPassword">
                                <label class="memberjoin_ex" for="pw_box">비밀번호</label>
                            </div>
                        </div>
                        <span id="pw_text" class="memberjoinError" style="color: rgba(100, 100, 100, 0.6);">소문자, 대문자, 숫자, 특수문자를 조합한 8~20자 </span>
                        <span id="pw_text2" class="memberjoinError"></span>
                        <br>
                        <br>
                        <!-- 비밀번호 검사 -->
                        <p class="info" id="pw_text" style="color:black"></p>
                        <div class="pw_errorimg">
                        <div class="pw_error memberjoinError"><img id="create_user_nicknameImg1" src="img/img_dot.png" alt="uppercase_check"><span id="uppercase_result"> 최소 1개의
                                대문자를 포함해야합니다.</span></div>
                        <div class="pw_error memberjoinError"><img id="create_user_nicknameImg2" src="img/img_dot.png" alt="lowercase_check"><span id="lowercase_result"><span> 최소
                                    1개의 소문자를 포함해야합니다.</span></div>
                        <div class="pw_error memberjoinError"><img id="create_user_nicknameImg3" src="img/img_dot.png" alt="Specialcase_check"><span id="Specialcase_result"> 최소
                                1개의 특수문자를 포함해야합니다.</span></div>
                        <div class="pw_error memberjoinError"><img id="create_user_nicknameImg4" src="img/img_dot.png" alt="numbercase_check"><span id="numbercase_result"> 최소 1개의
                                숫자를 포함해야합니다.</span></div>
                        <div class="pw_error memberjoinError"><img id="create_user_nicknameImg5" src="img/img_dot.png" alt="lengthcase_check"><span id="lengthcase_result"> 8자 이상
                                20자 이하로 작성해야합니다.</span></div>
                                </div>
                                <div class="memberjoin_dp_main">
                                    <div class="memberjoin_input">
                                        <input type="password" class="memberjoin_bar" id="pwCheckBox" placeholder='' 
                                            name="pwCheckBox" onblur="pw_test()">
                                        <label class="memberjoin_ex" for="pwCheckBox">비밀번호 확인</label>
                                    </div>
                                </div>
                                <span id="pw_test" class="memberjoinError memberjoin_error" style="color: rgba(100, 100, 100, 0.6);">비밀번호를 재입력 해주세요.</span>
                        <div class="memberjoin_next_btn memberjoin_btn1 ">
                        <p class="memberjoin_error  " id="memberjoin_nextbtn_error1"></p>
                        <button class="memberjoin_btn wearVillageBtn" onclick="prevSlide()">이전</button>
                            <button class="memberjoin_btn wearVillageBtn"  id="nextbtn"
                            >다음</button>
                        </div>
                    </div>
                    <!-- 2번째 화면 -->
                    <div class="memberjoin_display memberjoin_dp2">
                        <div class="memberjoin_dp_main">
                            <div class="memberjoin_top">
                                <h3>기본 정보</h3>
                                상세 정보를 입력하세요.
                            </div>
                            <div class="memberjoin_frofile_input">
                                <input name="uploadFile" type="file" id="profile_picture" accept="image/*">                                <label for="profile_picture">
                                    <img src="/img/기본프사.jpg" alt="" id="preview_image">
                                </label>
                                프로필 사진
                            </div>
                            <div class="memberjoin_input">
                                <!-- 닉네임 -->
                                <input type="text" class="memberjoin_bar" id="nickname_box" placeholder=""
                                    onblur="nickname_check();javascript:duplicate_check=false;" name="userNickname">
                                <label class="memberjoin_ex" for="nickname_box">닉네임</label>
                            </div>
                        </div>
                        <p class="memberjoin_info memberjoinError" id="nickname_text">&nbsp</p>
                        <div class="memberjoin_dp_main">
                            <!-- 생일 -->
                            <div class="memberjoin_input">
                                <input type="number" class="memberjoin_bar form-control" id="birthday" maxlength="4"
                                    oninput="numberMaxLength(this);" placeholder=''>
                                <label class="memberjoin_ex" for="birthday">생일 MMDD</label>
                            </div>
                        </div>
                        <p id="memberjoin_birth_error" class="memberjoinError">&nbsp</p>
                        <div class="memberJoin_gender" id="memberJoin_Inputgender">
                            <label>성별</label>
                            <input type="radio" name="gender" id="male" value="남">
                            <label for="male">남자</label>
                            <input type="radio" name="gender" id="female" value="여">
                            <label for="female">여자</label>
                            <br>
                            <div class="memberjoin_next_btn memberjoin_btn2">
                            <p class="memberjoin_error" id="memberjoin_nextbtn_error2"></p>
                            <button class="memberjoin_btn wearVillageBtn" onclick="prevSlide()">이전</button>
                            <button class="memberjoin_btn wearVillageBtn" id="nextbtn2" >다음</button>
                            </div>
                        </div>
                    </div>
                    <!-- 3번째 화면 -->
                    <div class="memberjoin_display memberjoin_dp3">
                        <div class="memberjoin_dp_main">
                            <div class="memberjoin_logo">
                                <img class="memberjoin_logo_img" src="img/img_wearVillageLogo.png" alt="">
                                <p class="footer_title">WearVillage</p>
                            </div>
                            <div class="memberjoin_top">
                                <h3>이메일 인증</h3>
                                이메일을 인증하면 완료됩니다.
                            </div>
                                <!-- 이메일 -->
                                <div class="memberjoin_input">
                                    <input type="text" class="memberjoin_bar" id="email_box" placeholder=''
                                        onblur="email_check()" name="userEmail" th:value="${user_email}"
                                        th:readonly="${email_readonly}">
                                    <label class="memberjoin_ex" for="email">이메일</label>
                                </div>
                        </div>
                        <form id='mail_form' th:action="@{/mail/send}" method="post">
                        <div class="memberjoin_email_check">
                        <p class="memberjoin_info memberjoinError" id="email_text" name="address2">이메일을 입력하세요.</p>
                        <input type="text" id="email_text2" name="address" value="" style="display:none;">
                            <textarea name="title" style="display:none;"></textarea>
                            <textarea name="content" style="display:none;"></textarea>
                            <script src="./js/forbiddenwords.js" rel="javascript"></script>
                            <script>
                                document.querySelector('#email_box').addEventListener('change',(e)=>{
                                    document.querySelector('#email_text2').value=e.target.value
                                })
                            </script>

<button type="submit" class="memberjoin_check_btn wearVillageBtn" id="email_check_btn">인증번호 발송</button>
</div>
                        </form>
                        <div class="memberjoin_dp_main">
                            <div class="memberjoin_input">
                                <input type="text" class="memberjoin_bar" id="authCodeBar" placeholder=''>
                                <label class="memberjoin_ex" for="authCodeBar">인증번호</label>
                                <input id="timer" type="text" value="3" style="display: none;"/>
                                <button id="submitBtn" class = "wearVillageBtn memberjoin_check_btn" value="인증하기">인증하기</button>
                                
                                <script>
                                    const $submitBtn = document.getElementById('submitBtn');
                                    $submitBtn.addEventListener('click',()=>{
                                        let authCode = document.getElementById("authCodeBar").value;
                                        fetch('/verify',{
                                            method:'POST',
                                            headers:{
                                                'Content-Type' : 'application/json'
                                            },
                                            body : JSON.stringify({authCode:authCode})
                                        })
                                        .then(res=>res.json())
                                            .then(data=>{
                                                if(data.success){
                                                    email_check_flag = true;
                                                    alert("인증성공");
                                                }else{
                                                    alert("인증실패");
                                                }
                                            })
                                    })
                                </script>

                            </div>
</div>
                        <div class="memberjoin_next_btn memberjoin_btn3">
                            <button class="memberjoin_btn wearVillageBtn" onclick="prevSlide()">이전</button>
                            <button type="button" id="memberjoin_lastbtn" onclick="create_user()"
                                class="noto_bold memberjoin_btn wearVillageBtn">
                                완료
                            </button>
                        </div>
                        
                        <script>
                            const $Timer=document.getElementById("timer");
                            let time = 60000;
                            let sec = 60;

                            $Timer.value=sec+'s';
                            function TIMER(){
                                PLAYTIME=setInterval(function(){
                                    time=time-1000;
                                    if (sec>0){
                                        sec=sec-1;
                                        $Timer.value=sec+'s';
                                    }
                                    if(sec===0){
                                        $Timer.value='인증시간만료'
                                        $AuthCodeBar = document.getElementById('authCodeBar');
                                    }
                                    if(email_check_flag==true){
                                        $Timer.value='인증완료'
                                    }
                                },1000);
                            }
                            const form = document.getElementById('mail_form');
                            form.addEventListener('submit',(e)=>{
                                e.preventDefault();

                            const payload = new FormData(form)
                            fetch('/mail/send',{
                                method:'POST',
                                body:payload,
                            })
                            .then(res=>res.json())
                            .then(json => console.log(json));

                            $Timer.style.display="block";
                            sec = 60;
                            TIMER();
                            setTimeout(function(){
                                clearInterval(PLAYTIME);
                            },60000);
                            
                            });

                        </script>
                        <p class="memberjoin_error" id="memberjoin_nextbtn_error3"></p>
        
                    </div>
                </div>
            </div>
        </div>
    </div>
        <script layout:fragment="javascript" rel="stylesheet" src="js/memberjoin.js"></script>
    </div>
</body>

</html>
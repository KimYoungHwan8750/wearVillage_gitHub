<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <title>View Post</title>
    <link
      rel="stylesheet"
      href="/src/main/resources/static/css/postDetail2.css"
    />
  </head>
  <body>
    <div class="postDetail_super_container">
      <div class="postDetail_container">
        <div class="thumb_nail_container">
          <div class="thumb_nail_main">
            <img src="img/1.jpg" alt="" />
          </div>
          <div class="thumb_nail_list">
            <div class="thumb_nail_first" id="imageContainer">
              <a href="#"><img src="img/1.jpg" alt="" /></a>
            </div>
            <div class="thumb_nail_second">
              <a href="#"><img src="img/1.jpg" alt="" /></a>
            </div>
            <div class="thumb_nail_third">
              <a href="#"><img src="img/1.jpg" alt="" /></a>
            </div>
          </div>
        </div>
        <div class="post_info_container">
          <div class="post_subtitle">
            <h2 th:text="${post.postSubtitle}"></h2>
          </div>
          <div class="post_product_info">
            <h3>Product Info <span style="color: gray">제품정보</span></h3>
            <!-- 버튼 넣기() -->
            <div class="product_tag">
              <button>하의</button> <button>스커트</button>
            </div>
            <!-- 태그 개수에 따라 js로 처리해야함. -->
          </div>

          <!-- <div class="writerId">
          작성자ID:<span th:text="${post.postWriterId}"></span>
        </div> -->
        </div>
      </div>
      <div class="postDetail_container2">
        <div class="post_text" th:utext="${post.postText}"></div>
        <!-- <time
          datetime=""
          th:text="${#dates.format(post.postDate,'yyyy-MM-dd')}"
        ></time> -->
      </div>
    </div>
    <!-- <div th:if="${post == null}">
      <p>No post found.</p>
    </div> -->

    <a href="/main">메인화면으로</a>
  </body>
  <script th:inline="javascript">
    let imageUrls = [];
    let postTextElement = document.createElement('div');
    postTextElement.innerHTML = /*[[${post.postText}]]*/ '';

    let imageEelements = postTextElement.getElementsByTagName('img');
    for (var i = 0; i < imageEelements.length; i++) {
      let imageUrl = imageEelements[i].getAttribute('src');
      imageUrls.push(imageUrl);
      // 3개까지만 넣는 로직 추가
    }
    let imageContainer = document.getElementById('imageContainer');
    for (let j = 0; j < imageUrls.length; j++) {
      let imgTag = document.createElement('img');
      imgTag.setAttribute('src', imageUrls[j]);
    }
  </script>
  <script th:inline="javascript">
    // post.postText에서 HTML 파싱하여 <img> 태그 찾기
    let postTextElements = document.createElement('div');
    postTextElements.innerHTML = /*[[${post.postText}]]*/ '';

    let imageElements = postTextElements.getElementsByTagName('img');

    // 첫 번째, 두 번째, 세 번째 썸네일 요소 찾기
    let thumbFirst = document.querySelector('.thumb_nail_first img');
    let thumbSecond = document.querySelector('.thumb_nail_second img');
    let thumbThird = document.querySelector('.thumb_nail_third img');
    let thumbMain = document.querySelector('.thumb_nail_main img');

    // 이미지가 있다면 각각의 썸네일 요소에 할당하기
    if (imageElements.length > 0 && thumbFirst) {
      thumbFirst.src = imageElements[0].src;
      if (imageElements.length > 1 && thumbSecond) {
        thumbSecond.src = imageElements[1].src;
        if (imageElements.length > 2 && thumbThird) {
          thumbThird.src = imageElements[2].src;
        }
      }
    }
    if (imageElements.length > 0 && thumbFirst) {
      thumbMain.src = imageElements[0].src;
    }

    document
      .querySelector('.thumb_nail_first img')
      .addEventListener('click', () => {
        document.querySelector('.thumb_nail_main img').src =
          imageElements[0].src;
      });

    document
      .querySelector('.thumb_nail_second img')
      .addEventListener('click', () => {
        document.querySelector('.thumb_nail_main img').src =
          imageElements[1].src;
      });

    document
      .querySelector('.thumb_nail_third img')
      .addEventListener('click', () => {
        document.querySelector('.thumb_nail_main img').src =
          imageElements[2].src;
      });
  </script>
</html>
